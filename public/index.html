<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agar.io Simplegame</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <style>
      .card label { display:block; margin:6px 0 4px; color:#8b949e; }
      .card input[type=text], .card input[type=password] { width:100%; padding:8px 10px; border-radius:8px; border:1px solid #30363d; background:#0b0f14; color:#fff; }
    </style>
  </head>
  <body class="page">
    <div class="container">
      <h1 class="title">Multiplayer Agar.io</h1>

      <div class="row gap">
        <a class="btn" href="/login.html">Login</a>
        <a class="btn" href="/signup.html">Sign Up</a>
      </div>

      <div class="grid two">
        <div class="card">
          <h2>Buat Room</h2>
          <form id="createRoom">
            <label>Nama kamu</label>
            <input id="name1" type="text" maxlength="16" required />
            <label style="display:inline-flex;align-items:center;gap:8px;margin-top:8px;">
              <input id="vsbot" type="checkbox" /> VS Komputer
            </label>
            <button class="btn" type="submit" style="margin-top:10px;">Buat</button>
          </form>
        </div>

        <div class="card">
          <h2>Masuk Room</h2>
          <form id="joinRoom">
            <label>Kode Room</label>
            <input id="code" type="text" maxlength="12" placeholder="ABC123" required />
            <button class="btn" type="submit" style="margin-top:10px;">Masuk</button>
          </form>
        </div>
      </div>

      <div class="card">
        <h2>Main sebagai Tamu</h2>
        <form id="guestForm">
          <div class="grid two">
            <div>
              <label for="guestName">Nama</label>
              <input id="guestName" placeholder="Nama kamu" maxlength="16" required />
            </div>
            <div>
              <label for="guestRoom">Kode Room</label>
              <input id="guestRoom" placeholder="ABC123" maxlength="12" required />
            </div>
          </div>
          <button class="btn" type="submit" style="margin-top:10px;">Masuk sebagai Tamu</button>
        </form>
      </div>

      <div class="card">
        <h2>Room Aktif (ringkas)</h2>
        <div id="roomList" class="room-list"></div>
      </div>
    </div>

    <script>
      async function loadRooms(){
        try{
          const res = await fetch('/api/rooms');
          const data = await res.json();
          const list = document.getElementById('roomList');
          list.innerHTML = '';
          (data.rooms||[]).forEach(r=>{
            const wrap = document.createElement('div');
            wrap.className = 'room-item';
            wrap.innerHTML = `
              <div>
                <div><strong>${r.code}</strong></div>
                <div>Owner: ${r.created_by} ${r.vs_bot ? 'â€¢ + BOT' : ''}</div>
              </div>
              <a class="btn" href="/room/${r.code}">Join</a>
            `;
            list.appendChild(wrap);
          });
        }catch{}
      }
      loadRooms();

      const createForm = document.getElementById('createRoom');
      createForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const name = document.getElementById('name1').value.trim();
        const vsbot = document.getElementById('vsbot').checked;
        const res = await fetch('/api/create-room', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ username: name, vsBot: vsbot }) });
        const data = await res.json();
        if (!data.ok) { alert('Gagal membuat room'); return; }
        const code = data.code;
        window.location.href = `/room.html?code=${encodeURIComponent(code)}&name=${encodeURIComponent(name)}&vsbot=${vsbot?'1':'0'}`;
      });

      const joinForm = document.getElementById('joinRoom');
      joinForm.addEventListener('submit',(e)=>{
        e.preventDefault();
        const code = document.getElementById('code').value.trim().toUpperCase();
        const name = localStorage.getItem('username') || 'Guest';
        window.location.href = `/room.html?code=${encodeURIComponent(code)}&name=${encodeURIComponent(name)}`;
      });

      const guestForm = document.getElementById('guestForm');
      guestForm.addEventListener('submit',(e)=>{
        e.preventDefault();
        const name = document.getElementById('guestName').value.trim();
        const code = document.getElementById('guestRoom').value.trim().toUpperCase();
        window.location.href = `/room.html?code=${encodeURIComponent(code)}&name=${encodeURIComponent(name)}`;
      });
    </script>
  </body>
  </html>


